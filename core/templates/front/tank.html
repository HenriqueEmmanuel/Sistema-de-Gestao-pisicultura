<!-- templates/front/tank.html -->
<!--REFORMULAR ESTA PAGINA PARA APENAS LISTAR E EDITAR OS TANQUES CADASTRADOS E CRIAR OUTRA PAGINA HTML PARA CADASTRAR OS TANQUES!-->


<div class="card tanques-card">
  <h2>Tanques Cadastrados</h2>

  <table id="tabela-tanques">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Tipo</th>
        <th>Espécie</th>
        <th>Situação</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <!-- Dados via JS -->
    </tbody>
  </table>

  <div class="edit-form" id="edit-form">
    <h3>Editar Tanque</h3>
    <form id="form-editar">
      <input type="hidden" id="edit-id">
      <label>Nome:</label>
      <input type="text" id="edit-nome">
      <label>Situação:</label>
      <select id="edit-situacao">
        <option value="Ativo">Ativo</option>
        <option value="Manutenção">Manutenção</option>
        <option value="Inativo">Inativo</option>
      </select>
      <button type="submit">Salvar Alterações</button>
    </form>
  </div>
</div>

<script>
  async function carregarTanques() {
    const resposta = await fetch('/api/tanques/');
    const tanques = await resposta.json();
    const tbody = document.querySelector('#tabela-tanques tbody');
    tbody.innerHTML = '';

    tanques.forEach(tanque => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${tanque.nome}</td>
        <td>${tanque.tipo}</td>
        <td>${tanque.especie_cultivada}</td>
        <td>${tanque.situacao}</td>
        <td><button onclick="editarTanque(${tanque.id}, '${tanque.nome}', '${tanque.situacao}')">Editar</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  function editarTanque(id, nome, situacao) {
    document.getElementById('edit-id').value = id;
    document.getElementById('edit-nome').value = nome;
    document.getElementById('edit-situacao').value = situacao;
    document.getElementById('edit-form').style.display = 'block';
  }

  document.getElementById('form-editar').addEventListener('submit', async function(e) {
    e.preventDefault();
    const id = document.getElementById('edit-id').value;
    const nome = document.getElementById('edit-nome').value;
    const situacao = document.getElementById('edit-situacao').value;

    await fetch(`/api/tanques/${id}/`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ nome, situacao })
    });

    document.getElementById('edit-form').style.display = 'none';
    carregarTanques();
  });

  carregarTanques();
</script>
